<!-- verified: agorbachev 03.05.2022 -->

<!-- 11.7.1 -->
## Частная подсеть и общедоступное адресное пространство IPv4

Сеть организации может использовать как частные, так и публичные блоки IP-адресов.

На рисунке показана типичная корпоративная сеть:

* **Интранет -** это внутренняя часть сети компании, доступная только внутри организации. Устройства в интрасети используют частные адреса IPv4.
* **DMZ -** Это часть сети компании, содержащей ресурсы, доступные в Интернете, такие как веб-сервер. Устройства в DMZ используют общедоступные адреса IPv4.

![](./assets/11.7.1.png)
<!-- /courses/itn-dl/aeed55b0-34fa-11eb-ad9a-f74babed41a6/af230bb0-34fa-11eb-ad9a-f74babed41a6/assets/2e37fbd5-1c25-11ea-81a0-ffc2c49b96bc.svg -->


Как Интранет, так и DMZ имеют свои собственные требования и проблемы в области подсетей.

Интрасеть использует частное пространство адресации IPv4. Это позволяет организации использовать любой из частных сетевых адресов IPv4, включая префикс 10.0.0.0/8 с 24 битами узлов и более 16 миллионами узлов. Использование сетевого адреса с 24 битами узлов делает подсеть проще и гибче. Это включает создание подсетей на границе октета с использованием /16 или /24.

Например, частный сетевой адрес IPv4 10.0.0.0/8 может быть поделен на подсети с помощью маски /16. Как показано в таблице, это приводит к 256 подсетям с 65 534 узлами на подсеть. Если организации требуется менее 200 подсетей, что позволяет некоторый рост, это дает каждой подсети более чем достаточно адресов узлов.

*Разделение сети 10.0.0.0/8 на подсети с использованием маски /16*

| **Адрес подсети<br>(256 возможных подсетей)** | **Диапазон хостов<br>(65,534 возможных хоста в подсети)** | **Широковещательный адрес** |
| --- | --- | --- |
| **10.0**.0.0/**16** | **10.0**.0.1 - **10.0**.255.254 | **10.0**.255.255 |
| **10.1**.0.0/**16** | **10.1**.0.1 - **10.1**.255.254 | **10.1**.255.255 |
| **10.2**.0.0/**16** | **10.2**.0.1 - **10.2**.255.254 | **10.2**.255.255 |
| **10.3**.0.0/**16** | **10.3**.0.1 - **10.3**.255.254 | **10.3**.255.255 |
| **10.4**.0.0/**16** | **10.4**.0.1 - **10.4**.255.254 | **10.4**.255.255 |
| **10.5**.0.0/**16** | **10.5**.0.1 - **10.5**.255.254 | **10.5**.255.255 |
| **10.6**.0.0/**16** | **10.6**.0.1 - **10.6**.255.254 | **10.6**.255.255 |
| **10.7**.0.0/**16** | **10.7**.0.1 - **10.7**.255.254 | **10.7**.255.255 |
| ... | ... | ... |
| **10.255**.0.0/**16** | **10.255**.0.1 - **10.255**.255.254 | **10.255**.255.255 |

Другой вариант использования частного IP-адреса 10.0.0.0/8 является разделением на подсети с использованием маски /24. Как показано в таблице, это приводит к 65 536 подсетям с 254 узлами на подсеть. Если организации требуется более 256 подсетей, то с помощью параметра /24 можно использовать 254 узла на подсеть.

*Разделение сети 10.0.0.0/8 на подсети с использованием маски /24*

| **Адрес подсети<br>(65,536 возможных подсетей)** | **Диапазон хостов<br>(254 возможных хоста в подсети)** | **Широковещательный адрес** |
| --- | --- | --- |
| **10.0.0**.0/**24** | **10.0.0**.1 - **10.0.0**.254 | **10.0.0**.255 |
| **10.0.1**.0/**24** | **10.0.1**.1 - **10.0.1**.254 | **10.0.1**.255 |
| **10.0.2**.0/**24** | **10.0.2**.1 - **10.0.2**.254 | **10.0.2**.255 |
| ... | ... | ... |
| **10.0.255**.0/**24** | **10.0.255**.1 - **10.0.255**.254 | **10.0.255**.255 |
| **10.1.0**.0/**24** | **10.1.0**.1 - **10.1.0**.254 | **10.1.0**.255 |
| **10.1.1**.0/**24** | **10.1.1**.1 - **10.1.1**.254 | **10.1.1**.255 |
| **10.1.2**.0/**24** | **10.1.2**.1 - **10.1.2**.254 | **10.1.2**.255 |
| ... | ... | ... |
| **10.100.0**.0/**24** | **10.100.0**.1 - **10.100.0**.254 | **10.100.0**.255 |
| ... | ... | ... |
| **10.255.255**.0/**24** | **10.255.255**.1 - **10.255.255**.254 | **10.255.255**.255 |

10.0.0.0/8 также можно разделить на  подсети, используя любое другое количество префиксов, например /12, /18, /20 и т.д. Это даст администратору сети широкий выбор опций. Использование частного IP-адреса 10.0.0.0/8 упрощает планирование и реализацию подсети.

**Что такое демилитаризованная зона (DMZ)?**

Поскольку эти устройства должны быть общедоступными из Интернета, устройства в DMZ требуют общедоступных адресов IPv4. Истощение публичного адресного пространства IPv4 стало проблемой, начиная с середины 1990-х годов. С 2011 года IANA и четыре из пяти RIR исчерпали адресное пространство IPv4. Несмотря на то, что организации осуществляют переход на IPv6, оставшееся адресное пространство IPv4 остается крайне ограниченным. Это означает, что организация должна максимально эффективно использовать собственное ограниченное количество публичных адресов IPv4. Это требует, чтобы администратор сети разделил свое общедоступное адресное пространство на подсети с разными масками подсети, чтобы свести к минимуму количество неиспользуемых адресов узлов в каждой подсети. Это называется маска переменной длины подсети (VLSM).

<!-- 11.7.2 -->
## Минимизация неиспользуемых адресов IPv4 узлов и максимизация подсетей

Чтобы свести к минимуму число неиспользуемых адресов IPv4 узлов и максимизировать количество доступных подсетей, при планировании подсетей необходимо учитывать два фактора: количество адресов узлов, необходимых для каждой сети, и количество необходимых отдельных подсетей.

В таблице на рисунке показаны особенности разделения на подсети с префиксом /24. Обратите внимание, на обратную зависимость между числом подсетей и числом узлов. Чем больше бит заимствовано для создания подсетей, тем меньше доступно бит в узловой части. Если требуется больше узлов, значит, нужно больше бит в узловой части, что приводит к уменьшению количества подсетей.

Количество адресов узлов, необходимых в самой крупной подсети, определяет, сколько бит нужно оставить в узловой части адреса. Как вы помните, два адреса использовать нельзя, поэтому фактически количество доступных адресов рассчитывается как 2^n-2.

*Разделение на подсети сети с маской /24*

| **Длина префикса** | **Маска подсети** | **Маска подсети в двоичном формате<br>(n = сеть; h = узел)** | **# Количество подсетей** | **# Хостов в каждой подсети** |
| --- | --- | --- | --- | --- |
| /25 | 255.255.255.128 | `nnnnnnnn.nnnnnnnn.nnnnnnnn.nhhhhhhh`<br>`11111111.11111111.11111111.10000000` | **2** | 126 |
| /26 | 255.255.255.192 | `nnnnnnnn.nnnnnnnn.nnnnnnnn.nnhhhhhh`<br>`11111111.11111111.11111111.11000000` | **4** | 62 |
| /27 | 255.255.255.224 | `nnnnnnnn.nnnnnnnn.nnnnnnnn.nnnhhhhh`<br>`11111111.11111111.11111111.11100000` | **8** | 30 |
| /28 | 255.255.255.240 | `nnnnnnnn.nnnnnnnn.nnnnnnnn.nnnnhhhh`<br>`11111111.11111111.11111111.11110000` | **16** | 14 |
| /29 | 255.255.255.248 | `nnnnnnnn.nnnnnnnn.nnnnnnnn.nnnnnhhh`<br>`11111111.11111111.11111111.11111000` | **32** | 6 |
| /30 | 255.255.255.252 | `nnnnnnnn.nnnnnnnn.nnnnnnnn.nnnnnnhh`<br>`11111111.11111111.11111111.11111100` | **64** | 2 |

Сетевые администраторы должны разработать схему сетевой адресации, чтобы обеспечить максимальное количество узлов в каждой сети и количество подсетей. Схема адресации должна предусматривать расширение как количества адресов узлов в каждой подсети, так и общего количества подсетей.

<!-- 11.7.3 -->
## Пример: эффективное разделение на подсети IPv4

В этом примере штаб-квартира оператора связи выделила адрес частной сети 172.16.0.0/22 (10 бит в узловой части) для филиала. Как показано на рисунке, в результате мы получаем 1022 адресов узлов.

**Примечание**: 172.16.0.0/22 является частью частного адресного пространства IPv4. Мы используем этот адрес вместо фактического публичного IPv4 адреса.

![](./assets/11.7.3-1.png)
<!-- /courses/itn-dl/aeed55b0-34fa-11eb-ad9a-f74babed41a6/af230bb0-34fa-11eb-ad9a-f74babed41a6/assets/2e387105-1c25-11ea-81a0-ffc2c49b96bc.svg -->

Штаб-квартира компании имеет DMZ и четыре филиала, каждый из которых нуждается в собственном публичном адресном пространстве IPv4. Штаб-квартира компании должна наилучшим образом использовать ограниченное адресное пространство IPv4.

Топология, показанная на рисунке, состоит из пяти сайтов: корпоративного офиса и четырех филиалов. Каждый сайт требует подключения к Интернету и, следовательно, пять подключений к Интернету. Это означает, что организация требует 10 подсетей с публичного адреса 172.16.0.0/22 компании. Самая большая подсеть должна содержать 40 узлов.

![](./assets/11.7.3-2.png)
<!-- /courses/itn-dl/aeed55b0-34fa-11eb-ad9a-f74babed41a6/af230bb0-34fa-11eb-ad9a-f74babed41a6/assets/2e389816-1c25-11ea-81a0-ffc2c49b96bc.svg -->

Сетевой адрес 172.16.0.0/22 имеет 10 бит в узловой части, как показано на рисунке. Поскольку самой крупной подсети требуется 40 узлов, для обеспечения их адресации требуется не менее 6 бит в узловой части. Это число определяется по следующей формуле: 2<sup>6</sup> - 2 = 62 узла.

![](./assets/11.7.3-3.png)
<!-- /courses/itn-dl/aeed55b0-34fa-11eb-ad9a-f74babed41a6/af230bb0-34fa-11eb-ad9a-f74babed41a6/assets/2e38e630-1c25-11ea-81a0-ffc2c49b96bc.svg -->

По формуле определения количества подсетей получаем 16 подсетей: 2<sup>4</sup> = 16. Поскольку в нашем примере сетевой инфраструктуры требуются 10 подсетей, это соответствует нашим требованиям и обеспечивает некоторый запас для роста в будущем.

Таким образом, первые 4 бита в узловой части можно использовать для создания подсетей. Это означает, что будут заимствованы два бита из 3-го октета и два бита из 4-го октета. Если заимствовать 4 бита, новая длина префикса будет /26 с маской подсети 255.255.255.192.

Как показано на рисунке, подсети можно назначить сегментам локальной сети (LAN) и соединениям между маршрутизаторами.

![](./assets/11.7.3-4.png)
<!-- /courses/itn-dl/aeed55b0-34fa-11eb-ad9a-f74babed41a6/af230bb0-34fa-11eb-ad9a-f74babed41a6/assets/2e38e63a-1c25-11ea-81a0-ffc2c49b96bc.svg -->

<!-- 11.7.4 -->
<!-- ## Задание. Определение количества бит для заимствования -->

<!-- 11.7.5 -->
## Работа в симуляторе: сценарий разделения на подсети

В этом упражнении вам предоставляется сетевой адрес 192.168.100.0/24 для подсети, и вы должны составить схему IP-адресации сети, изображенной в топологии. Для каждой локальной сети (LAN) в сети требуется достаточно пространства для, по крайней мере, 25 адресов для оконечных устройств, коммутатора и маршрутизатора. Для соединения между маршрутизаторами R1 и R2 потребуется по одному IP-адресу на каждом конце канала.

[Сценарий разделения на подсети (pdf)](./assets/11.7.5-packet-tracer---subnetting-scenario_ru-RU.pdf)

[Сценарий разделения на подсети (pka)](./assets/11.7.5-packet-tracer---subnetting-scenario_ru-RU.pka)

