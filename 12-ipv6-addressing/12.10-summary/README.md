<!-- verified: agorbachev 03.05.2022 -->

<!-- 12.9.3 -->
## Проблемы с протоколом IPv4

Теоретическое максимальное количество IPv4-адресов — 4,3 миллиарда. Частные адреса вместе с NAT помогли замедлить истощение адресного пространства IPv4. В связи с распространением Интернета, ограниченным адресным пространством IPv4, проблемами с преобразованием сетевых адресов и проникновением Интернета в нашу жизнь пришло время для перехода на протокол IPv6.

Как IPv4, так и IPv6 будут сосуществовать в ближайшем будущем, и переход займет несколько лет. Специалисты IETF создали различные протоколы и инструменты, которые позволяют сетевым администраторам постепенно переводить свои сети на протокол IPv6. Методы перехода можно разделить на три категории: двойной стек, туннелирование и трансляция.

## Представление IPv6 адресации

Длина IPv6-адресов составляет 128 бит, написанных в виде строки шестнадцатеричных значений. Каждые 4 бита представлены одной шестнадцатеричной цифрой (сегментом или гекстетом), причем общее количество шестнадцатеричных значений равно 32. Предпочтительный формат записи IPv6-адреса: x:x:x:x:x:x:x:x, где каждый «x» состоит из четырех шестнадцатеричных цифр. Например: 2001:0db8:0000:1111:0000:0000:0000:0200. 

Существуют два правила сокращения IPv6-адресов. Первое — пропуск всех начальных нулей в шестнадцатеричной записи. Например: 2001:db8:0:1111:0:0:0:200. Второе правило заключается в том, что двойное двоеточие (::) может заменить любую единую смежную строку одного или нескольких 16-битных сегментов (гекстетов), состоящих из нулей.  Например: 2001:db8:0:1111::200.

## Типы IPv6 адресов

Существует три типа IPv6-адресов: индивидуальные (одноадресная рассылка), групповые (многоадресная рассылка) и произвольные. IPv6 не использует для маски подсети десятичное представление с разделительными точками. Как и IPv4, длина префикса представлена в виде косой черты и указывает на сетевую часть адреса IPv6. 

Индивидуальный адрес однозначно определяет интерфейс устройства под управлением протокола IPv6. Адреса IPv6 обычно имеют два одноадресных адреса: GUA и LLA. 

Уникальные локальные адреса IPv6 используются для локальной адресации внутри сайта или между ограниченным числом сайтов, могут использоваться для устройств, которым никогда не понадобится доступ к другой сети, и не будут глобально маршрутизированы или переведены на глобальный IPv6-адрес. 

Глобальные индивидуальные IPv6-адреса (GUA) уникальны по всему миру и доступны для маршрутизации через Интернет IPv6. Эти адреса эквивалентны публичным IPv4-адресам. GUA состоит из трех частей: префикс глобальной маршрутизации, идентификатор подсети и идентификатор интерфейса. 

Локальный IPv6-адрес канала позволяет устройству обмениваться данными с другими устройствами с включенным протоколом IPv6 в том же канале (подсети) и только в нем. Устройствам могут назначаться как статические, так и динамические IP-адреса.

## Статическая настройка глобальных адресов для одноадресной рассылки и локальные адреса канала

Для настройки адреса IPv4 на интерфейсе используется команда Cisco IOS **ip address** _ip-address subnet-mask_. В отличие от этого, для настройки GUA IPv6 на интерфейсе используют команду **ipv6 address** _ipv6-address/prefix-length_. 

Как и в случае с IPv4, настройка статических адресов для клиентов не распространяется на крупные сети. Именно поэтому большинство сетевых администраторов IPv6-сети будут назначать IPv6-адреса динамически. 

Ручная настройка локального адреса канала позволяет создавать адрес, который легче узнать и запомнить. Как правило, достаточно создать распознаваемые локальные адреса на маршрутизаторах. LLA можно настроить вручную с помощью **ipv6 address** команды **link-local** _ipv6-link-local-address_.

## Динамическакая адресация GUA для одноадресной рассылки IPv6

Устройство получает GUA динамически через сообщения ICMPv6. IPv6-маршрутизаторы каждые 200 секунд отправляют сообщения RA ICMPv6 всем устройствам в сети. На хост будет отправлено сообщение RA в ответ на запрос. Сообщение ICMPv6 RA содержит длину префикса и префикса сети, адрес шлюза по умолчанию, а также DNS-адреса и имя домена. Сообщения RA имеют три метода: SLAAC, SLAAC с сервером DHCPv6 без состояния и DHCPv6 с сохранением состояния (без SLAAC). 

При использовании SLAAC клиентское устройство использует информацию из сообщения RA для создания собственного GUA, так как сообщение содержит префикс и идентификатор интерфейса. При использовании SLAAC с DHCPv6 без состояния сообщение RA предлагает устройствам использовать SLAAC для создания собственного GUA IPv6, использовать LLA маршрутизатора в качестве адреса шлюза по умолчанию и использовать сервер DHCPv6 без состояния для получения другой необходимой информации. 

При использовании DHCPv6 с сохранением состояния RA предлагает устройствам использовать LLA маршрутизатора в качестве адреса шлюза по умолчанию, а DHCPv6 сервер с сохранением состояния для получения GUA, адреса DNS-сервера, доменного имени и всей другой необходимой информации. 

Идентификатор интерфейса может быть создан с помощью EUI-64 или представлять собой случайно созданное 64-битное число. Этот процесс использует 48-битный MAC-адрес Ethernet клиента и в середину этого адреса вставляет еще 16 бит для создания 64-битного идентификатора интерфейса. В зависимости от операционной системы устройство может использовать случайно сгенерированный идентификатор интерфейса вместо МАС-адресов и EUI-64.

## Динамическая адресация локальных адресов канала IPv6

Все устройства IPv6 должны иметь LLA IPv6. LLA можно настроить вручную или создать динамически. Операционные системы, такие как Windows, обычно используют один и тот же метод как для создаваемого SLAAC GUA, так и для динамически назначаемого LLA. 

Маршрутизаторы Cisco автоматически создают локальный IPv6-адрес канала после назначения интерфейсу глобального индивидуального адреса. По умолчанию маршрутизаторы Cisco IOS используют процесс EUI-64 для создания идентификатора интерфейса для всех локальных адресов канала в IPv6-интерфейсах. 

Для последовательных интерфейсов маршрутизатор будет использовать MAC-адрес интерфейса Ethernet. Чтобы было легче узнавать и запоминать эти адреса на маршрутизаторах, обычно выполняется статическая настройка локальных IPv6-адресов канала на маршрутизаторах. Чтобы проверить конфигурацию адреса IPv6, используйте следующие три команды: **show ipv6 interface brief**, **show ipv6 route** и **ping**.

## Групповые IPv6 адреса

Существует два типа адресов многоадресной рассылки IPv6: известные адреса многоадресной рассылки и адреса многоадресной рассылки запрашиваемых узлов. Стандартные групповые адреса зарезервированы для заданных групп устройств. 

Назначены известные адреса многоадресной рассылки. Группа многоадресной рассылки всех узлов начинается с ff02:1. Группа многоадресной рассылки всех маршрутизаторов начинается с ff02::2. 

Групповой адрес запрашиваемых узлов аналогичен групповому адресу для всех узлов. Преимущество группового адреса запрашиваемых узлов в том, что он соответствует специальному адресу многоадресной рассылки Ethernet.

## Разделение сети IPv6 на подсети

IPv6 разработали с учетом подсетей. Для создания подсетей используется отдельное поле ID подсети в GUA IPv6. Поле ID подсети — это область между префиксом глобальной маршрутизации и идентификатором интерфейса. Преимущество 128-битного адреса в том, что он поддерживает более чем достаточное количество подсетей и узлов в каждой подсети. Например, если префикс глобальной маршрутизации имеет значение /48 и использует типичные 64 бита для идентификатора интерфейса, это создаст 16-битный идентификатор подсети:

* 16-битный идентификатор подсети создает до 65 536 подсетей,
* 64-битный идентификатор интерфейса поддерживает до 18 000 000 000 000 000 000 IPv6-адресов на подсеть.

Когда на выбор доступно 65 000 подсетей, задачей сетевого администратора становится проектирование логической структуры адресов в этой сети. Сохранение адресов не является проблемой при использовании IPv6. Аналогично настройке IPv4, каждый интерфейс маршрутизатора настроен как находящийся в другой IPv6-подсети.

<!-- 12.9.4 -->
<!-- quiz -->

