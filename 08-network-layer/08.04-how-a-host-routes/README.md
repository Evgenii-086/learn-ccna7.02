<!-- verified: agorbachev 03.05.2022 -->

<!-- 8.4.1 -->
## Решение о перенаправлении узла

С IPv4 и IPv6 пакеты всегда создаются на исходном хосте. Хост источника должен иметь возможность направлять пакет на хост назначения. Для этого хост-конечные устройства создают собственную таблицу маршрутизации. В этом разделе описывается, как конечные устройства используют таблицы маршрутизации.

Другим предназначением сетевого узла является пересылка пакетов между узлами. Узел может отправить пакет на следующие адреса:

* **Себе** \- хост может пинговать себя посылая пакеты на специальный IPv4-адрес 127.0.0.1 или IPv6-адрес ::1, который называется интерфейсом обратной связи. Отправка эхозапроса на интерфейс loopback тестирует стек протокола TCP/IP на узле.
* **Локальный узел.**  Узел в той же локальной сети, в которой также находится отправляющий узел. Хосты источника и назначения используют один и тот же сетевой адрес.
* **Удаленный узел.**  Узел в удаленной сети. Хосты источника и назначения не используют один и тот же сетевой адрес.

На рисунке показано подключение PC1 к локальному узлу в той же сети и к удаленному узлу, расположенному в другой сети.

![](./assets/8.4.1.png)


Определяет, предназначен ли пакет для локального узла или удаленного узла, определяется конечным устройством источника. Конечное устройство источника определяет, находится ли конечный IP-адрес в той же сети, в которой находится само устройство источника. Метод определения варьируется в зависимости от версии IP:

* **В IPv4**  исходное устройство использует собственную маску подсети вместе с собственным адресом IPv4 и адресом назначения IPv4 для определения того, находится ли узел назначения в одной сети.
* **В IPv6** — локальный маршрутизатор объявляет адрес локальной сети (префикс) всем устройствам в сети.

В домашней или корпоративной сети могут находиться несколько проводных и беспроводных устройств, соединенных друг с другом с помощью промежуточного устройства, такого как коммутатор локальной сети (LAN) или точка беспроводного доступа (WAP). Это промежуточное устройство обеспечивает соединение между локальными узлами в локальной сети. Локальные узлы могут получать доступ друг к другу и обмениваться информацией без использования каких-либо дополнительных устройств. Если узел отправляет пакет устройству, которое настроено в этой же IP-сети в качестве главного устройства, пакет просто пересылается из интерфейса узла через промежуточное устройство прямо на устройство назначения.

Разумеется, в большинстве случаев нам требуется, чтобы наши устройства могли устанавливать соединения за пределами сегмента локальной сети: подключаться к другим домам, офисам и Интернету. Устройства, которые не входят в сегмент локальной сети, называются удаленными узлами. Если исходное устройство отправляет пакет к удаленному устройству назначения, то в этом случае требуется помощь маршрутизаторов и выполнение маршрутизации. Маршрутизация — это процесс определения оптимального пути к хосту назначения. Маршрутизатор, подключенный к сегменту локальной сети, называется шлюзом по умолчанию.

<!-- 8.4.2 -->
## Шлюз по умолчанию

Шлюз по умолчанию — это сетевое устройство (т.е. маршрутизатор или коммутатор уровня 3), которое направляет трафик в другие сети. Если в качестве аналогии сети использовать комнату, шлюзом по умолчанию будет входная дверь. Для того чтобы попасть в другую комнату или сеть, нужно найти входную дверь.

В сети шлюзом по умолчанию обычно является маршрутизатор со следующими функциями:

* Имеет локальный IP-адрес в том же диапазоне адресов, что и другие хосты в сети.
* Он может принимать данные в локальную сеть и пересылать данные из локальной сети.
* Направляет трафик в другие сети.

Шлюз по умолчанию необходим для отправки трафика за пределы локальной сети. Трафик не может быть перенаправлен за пределы локальной сети, если отсутствует шлюз по умолчанию, адрес шлюза по умолчанию не настроен или шлюз по умолчанию отключен.

<!-- 8.4.3 -->
## Хост-маршруты к шлюзу по умолчанию

Таблица маршрутизации узла, как правило, содержит шлюз по умолчанию. В IPv4, узел получает IPv4-адрес шлюза по умолчанию динамически от протокола динамической настройки узла (DHCP) или из вручную настроенных параметров. В IPv6 маршрутизатор объявляет адрес шлюза по умолчанию, или узел можно настроить вручную.

На рисунке компьютеры PC1 и PC2 настроены на использование шлюза по умолчанию с IPv4-адресом 192.168.10.1.

![](./assets/8.4.3.png)


В таблице маршрутизации ПК при наличии настроенного шлюза по умолчанию создается маршрут по умолчанию. Маршрут по умолчанию — маршрут или путь, по которому идет компьютер, когда он пытается связаться с удаленной сетью.

И компьютер PC1, и компьютер PC2 будут иметь маршрут по умолчанию для отправки всего трафика, предназначенного для удаленных сетей, к маршрутизатору R1.

<!-- 8.4.4 -->
## Таблицы маршрутизации узла

На узле Windows команда **route print** или **netstat -r** можно использовать для отображения таблицы маршрутизации узла. Обе команды выдают одинаковый результат. Сначала полученные выходные данные могут показаться слишком обширными, однако разобраться в них довольно легко.

На рисунке отображается образец топологии и выходные данные, созданные  командой **netstat –r**.

![](./assets/8.4.4.png)


### Таблица маршрутизации IPv4 для компьютера PC1

```
C:\Users\PC1 > netstat -r 
таблица маршрутизации IPv4
===========================================================================
Active Routes:
Network Destination Netmask Gateway Interface Metric
          0.0.0.0 0.0.0.0 192.168.10.1 192.168.10.10 25
        127.0.0.0 255.0.0.0 On-link 127.0.0.1 306
        127.0.0.1 255.255.255.255 On-link 127.0.0.1 306
  127.255.255.255 255.255.255.255 On-link 127.0.0.1 306
     192.168.10.0 255.255.255.0 On-link 192.168.10.10 281
    192.168.10.10 255.255.255.255 On-link 192.168.10.10 281
   192.168.10.255 255.255.255.255 On-link 192.168.10.10 281
        224.0.0.0 240.0.0.0 On-link 127.0.0.1 306
        224.0.0.0 240.0.0.0 On-link 192.168.10.10 281
  255.255.255.255 255.255.255.255 On-link 127.0.0.1 306
  255.255.255.255 255.255.255.255 On-link 192.168.10.10 281

```

**Примечание:** Выходные данные отображают только таблицу маршрутов IPv4.

После ввода команды **netstat -r** или равноценной ей команды **route print** будут отображены следующие три раздела, относящиеся к текущим сетевым подключениям TCP/IP.

* **Список интерфейса.**  Содержит адрес управления доступом к среде (MAC-адрес) и присвоенный номер интерфейса с поддержкой сети на узле, включая адаптеры Ethernet, Wi-Fi и Bluetooth.
* **Таблица маршрутизации IPv4.**  Содержит все известные маршруты IPv4, включая прямые подключения, локальные сети и локальные маршруты, используемые по умолчанию.
* **Таблица маршрутизации IPv6.**  Содержит все известные маршруты IPv6, включая прямые подключения, локальные сети и локальные маршруты, используемые по умолчанию.

<!-- 8.4.5 -->
<!-- quiz -->

