<!-- verified: agorbachev 03.05.2022 -->

<!-- 7.4.1 -->
## Способы пересылки кадра на коммутаторах

Как вы узнали в предыдущем разделе, коммутаторы используют таблицы MAC-адресов, чтобы определить, какой порт следует использовать для пересылки кадров. В коммутаторах Cisco существует два метода переадресации кадров, и есть веские причины использовать один вместо другого, в зависимости от ситуации.

Коммутаторы используют один из двух способов пересылки для коммутации данных между сетевыми портами.

* **Коммутация с промежуточным хранением.** В этом методе пересылки коммутатор получает кадр целиком и вычисляет циклический избыточный кода (CRC). CRC использует математическую формулу, основанную на количестве бит (единиц) в кадре, что позволяет определить наличие в нем ошибок. Если значение CRC допустимо, коммутатор ищет адрес назначения, который определяет выходной интерфейс. Затем кадр перенаправляется к правильному порту.
* **Коммутация со сквозной пересылкой.** В этом режиме коммутатор пересылает данный кадр до его полного получения. Рекомендуется указать адрес назначения в начале, прежде чем кадр может быть переадресован.

Большим преимуществом коммутации с промежуточным хранением является то, что она определяет, есть ли у кадра ошибки перед передачей. Если обнаружена ошибка, коммутатор отклонит его. Отклонение кадров с ошибками позволяет уменьшить ширину полосы пропускания, потребляемую поврежденными данными. Коммутация с промежуточным хранением необходима для анализа качества обслуживания (QoS) в конвергентных сетях, в которых требуется классификация кадра для назначения приоритетов проходящего трафика. Например, при передаче речи по IP потоки данных должны иметь больший приоритет, чем трафик, используемый для просмотра веб-страниц.

![](./assets/7.4.1.png)

<!-- 7.4.2 -->
## Сквозная коммутация (Cut-Through)

При использовании сквозной коммутации коммутатор обрабатывает данные по мере их поступления даже в том случае, если передача еще не завершена. Коммутатор добавляет в буфер только ту часть кадра, которая требуется для чтения MAC-адреса назначения, чтобы он смог определить, на какой порт пересылать данные. MAC-адрес назначения указан в первых 6 байтах кадра после преамбулы. Коммутатор ищет MAC-адрес назначения в своей таблице коммутации, определяет порт исходящего интерфейса и направляет кадр на узел назначения через определенный порт. Коммутатор не проверяет кадр на наличие каких-либо ошибок.

Воспроизведите анимацию, демонстрирующую принцип сквозной коммутации.

![](./assets/7.4.2.png)

Существуют два варианта сквозной коммутации.

* **Коммутация с быстрой пересылкой.** Она обеспечивает наименьший уровень задержки. При такой коммутации пакет пересылается сразу же после чтения адреса назначения. Поскольку в таком случае передача начинается до того, как будет получен весь пакет, могут быть моменты, когда пакеты ретранслируются с ошибками. Это происходит редко, а сетевой адаптер назначения отклоняет пакет с ошибками после его получения. В режиме быстрой пересылки задержка измеряется с момента получения первого бита до его передачи. Коммутация с быстрой пересылкой является типичным способом сквозной коммутации.
* **Коммутация с исключением фрагментов**. При таком способе коммутатор сохраняет первые 64 байта кадра перед его отправкой. Причина заключается в том, что большинство сетевых ошибок и коллизий происходит именно в первых 64 байтах. Такая коммутация позволяет повысить эффективность коммутации с быстрой пересылкой благодаря выполнению небольшой проверки ошибок в первых 64 байтах кадра, чтобы перед пересылкой убедиться в отсутствии коллизии. Коммутация с исключением фрагментов представляет собой компромисс между большой задержкой с высокой целостностью (коммутация с промежуточным хранением) и малой задержкой с меньшей целостностью (коммутация с быстрой пересылкой).

Некоторые коммутаторы настроены на использование сквозной коммутации для каждого порта до тех пор, пока не будет достигнуто указанное пользователем предельное количество ошибок, после чего автоматически устанавливается коммутация с промежуточным хранением. После того, как частота повторения ошибок снизится до установленного предельного значения, порт автоматически переключится на использование сквозной коммутации.

<!-- 7.4.3 -->
## Буферизация памяти на коммутаторах

Коммутатор Ethernet может использовать метод буферизации для хранения кадров до их пересылки. Буферизация также может использоваться, когда порт назначения занят из-за перегрузки. Коммутатор сохраняет кадр до тех пор, пока он не будет передан.

Как показано в таблице, существуют два метода буферизации памяти: буферизация на базе портов и буферизация совместно используемой памяти.

### Методы буферизации памяти

| **Метод** | **Описание** |
| --- | --- |
| **Буферизация памяти на основе портов** | <ul> <li> Кадры хранятся в очередях, связанных с определенными входящими и исходящими портами. </li> <li> Кадр передается на исходящий порт только тогда, когда все кадры впереди в очереди были успешно переданы. </li> <li> Для одного кадра возможно задержать передачу всех кадров в памяти из-за занятого порта назначения. </li> <li> Такая задержка возникает и в том случае, если другие кадры можно передать на открытые порты назначения. </li> </ul> |
| **Буферизация совместно используемой памяти** | <ul> <li> Помещает все кадры в общий буфер памяти, совместно используемый всеми портами коммутатора, и объем буферной памяти, требуемой для порта, распределяется динамически. </li> <li> Кадры в буфере динамически связываются с портом назначения. позволяющий получить пакет на одном порту, а затем передается на другой порт, не перемещая его в другую очередь. </li> </ul> |

Буферизация общей памяти также приводит к возможности хранения больших кадров с потенциально меньшим количеством отброшенных кадров. Это важно при асимметричной коммутации, которая обеспечивает различную скорость передачи данных на разных портах, например, при подключении сервера к порту коммутатора 10 Гбит/с и ПК к портам 1 Гбит/с.

<!-- 7.4.4 -->
## Настройка дуплексного режима и скорости

К двум базовым параметрам коммутатора относятся пропускная способность и дуплексный режим, которые задаются для каждого отдельного порта коммутатора. Важно, чтобы настройки дуплексного режима и пропускной способности порта коммутатора и подключенных устройств, таких как компьютер или другой коммутатор, совпадали.

Для обмена данными в сетях Ethernet используются два типа настроек дуплексного режима:

* **полнодуплексный режим** (одновременная отправка и получение данных в обе стороны);
* **полудуплексный режим** (отправка данных только одной стороной).

**Автоопределение** — это дополнительная функция, которой оснащено большинство коммутаторов и сетевых плат Ethernet. Автоопределение позволяет двум устройствам автоматически обмениваться информацией о скорости и возможностях дуплексного режима. Если оба устройства поддерживают полнодуплексный режим, для работы выбирается этот режим вместе с максимальной пропускной способностью, общей для двух устройств.

Например, сетевая плата Ethernet компьютера PC-A, показанная на рисунке, может работать в полнодуплексном или полудуплексном режиме на скорости 10 или 100 Мбит/с.

![](./assets/7.4.4-1.svg)


Компьютер PC-A соединен через порт 1 с коммутатором S1, который может работать в полнодуплексном или полудуплексном режиме на скорости 10, 100 или 1 000 Мбит/с (1 Гбит/с). Если в обоих устройствах есть автоопределение, то будет выбраны полнодуплексный режим и скорость 100 Мбит/с.

**Примечание.** В большинстве коммутаторов и сетевых плат Ethernet компании Cisco используется автоопределение скорости и настроек дуплексного режима. Порты Gigabit Ethernet работают только в полнодуплексном режиме.

Несоответствие дуплексных режимов является наиболее распространенной причиной снижения производительности каналов Ethernet. Это происходит, когда один порт канала работает в полудуплексном режиме, а другой — в полнодуплексном.

![](./assets/7.4.4-2.svg)


В коммутаторе S2 будут по-прежнему возникать коллизии, поскольку коммутатор S1 непрерывно отправляет имеющиеся кадры.

Это происходит при сбросе одного или обоих портов канала, в результате чего автоопределение не приводит к одинаковой конфигурации обоих устройств связи. Это также может произойти тогда, когда пользователи меняют конфигурацию на одной стороне канала и забывают про другую. Автоопределение должно быть включено либо отключено на обеих сторонах канала. Рекомендуется настроить оба порта коммутатора Ethernet в полнодуплексный режим.

<!-- 7.4.5 -->
## Функция Auto-MDIX

Для соединения устройств когда-то требовалось использование либо перекрестного, либо прямого кабеля. Тип необходимого кабеля зависит от типа соединяемых устройств.

Например, на рисунке указан правильный тип кабеля, необходимый для соединения устройств коммутатор-коммутатор, коммутатор-роутер, коммутатор-хост или роутер-хост. Перекрестный кабель используется при подключении подобных устройств, а прямой кабель используется для подключения непохожих устройств.

**Примечание.** Прямое соединение между роутером и узлом требует перекрестного подключения.

![](./assets/7.4.5.svg)


Теперь большинство устройств поддерживают функцию автоматического определения перекрещивания пар на зависящем от среды передачи интерфейсе (Auto-MDIX). Если функция Auto-MDIX включена, коммутатор определяет необходимый тип кабеля, подключенного к порту, и настраивает интерфейс соответствующим образом. Таким образом, для подключения к медным портам 10/100/1000 Мбит/с на коммутаторе можно использовать либо перекрестный, либо прямой кабель независимо от типа устройства на другом конце соединения.

Функция Auto-MDIX включена по умолчанию на коммутаторах с операционной системой Cisco IOS 12.2 (18) SE или более поздней версии. Однако эта функция может быть отключена. По этой причине всегда следует использовать правильный тип кабеля и не полагаться на функцию Auto-MDIX. Функция Auto-MDIX может быть повторно включена с помощью команды конфигурации интерфейса **mdix auto**.

<!-- 7.4.6 -->
<!-- quiz -->

