<!-- verified: agorbachev 03.05.2022 -->

<!-- 7.3.1 -->
## Основная информация о коммутаторах

Теперь, когда вы знаете все о MAC-адресах Ethernet, пришло время рассказать о том, как коммутатор использует эти адреса для пересылки (или отбрасывания) кадров на другие устройства в сети. Если бы коммутатор просто переадресовывал каждый кадр, который он получил на все порты, ваша сеть была бы настолько перегружена, что, вероятно, полностью остановилась бы.

Коммутатор Ethernet уровня 2 использует MAC-адреса для принятия решения о пересылке. Устройство не имеет информации о протоколе, передаваемом в части кадра, выделенной для данных, например, в IPv4-пакете или ND-пакет IPv6. Коммутатор пересылает пакеты только на основе MAC-адресов Ethernet уровня 2.

В отличие от устаревших концентраторов Ethernet, которые повторяют биты на всех портах, кроме входящего, коммутатор Ethernet обращается к таблице MAC-адресов для пересылки каждого конкретного кадра. На рисунке показан только что включенный 4-портовый коммутатор. Таблица показывает таблицу MAC-адресов, которая еще не изучила MAC-адреса для четырех подключенных компьютеров.

**Примечание**: Для удобства в этом примере MAC-адреса представлены в сокращенном виде.

![](./assets/7.3.1.png)


На диаграмме показаны четыре узла, а также связанные с ними MAC-адреса, подключенные к портам 1 - 4 коммутатора. Таблица MAC-адресов, которая сопоставляет порты с MAC-адресами, в настоящее время пуста.

**Примечание**: Таблицу MAC-адресов иногда называют таблицей ассоциативной памяти (CAM). Хотя понятие «таблица ассоциативной памяти» используется относительно часто, в этом курсе мы будем называть ее таблицей MAC-адресов.

<!-- 7.3.2 -->
## Режим обучения

Коммутатор создает таблицу MAC-адресов динамически, проверяя MAC-адрес источника в кадрах, принимаемых портом.Он пересылает кадры на основе совпадения между MAC-адресом назначения в кадре и записью в таблице MAC-адресов.

### Получение информации

При каждом поступлении кадра в коммутатор выполняется проверка на наличие новой информации. Проверяются MAC-адрес источника, указанный в кадре, и номер порта, по которому кадр поступает в коммутатор. Если MAC-адрес источника отсутствует, он добавляется в таблицу вместе с номером входящего порта. Если MAC-адрес источника уже существует, коммутатор обновляет таймер обновления для этой записи. По умолчанию в большинстве коммутаторов Ethernet данные в таблице хранятся в течение 5 минут.

Например, на рисунке PC-A отправляет кадр Ethernet на PC-D. Таблица показывает, что коммутатор добавляет MAC-адрес для PC-A в таблицу MAC-адресов.

**Примечание**: Если MAC-адрес источника указан в таблице, но с другим портом, коммутатор считает эту запись новой. Запись заменяется на тот же MAC-адрес, но с более актуальным номером порта.

![](./assets/7.3.2-1.png)


1.  Узел A отправляет кадр с MAC-адресом назначения 00-0D. MAC-адрес источника кадра — 00-0A.
2.  Коммутатор сопоставляет порт 1 MAC-адрес 00-0A в своей таблице MAC-адресов.

### Перенаправление

Если MAC-адрес назначения является адресом одноадресной рассылки, коммутатор ищет совпадения между MAC-адресом назначения кадра и записью в таблице MAC-адресов. Если MAC-адрес назначения есть в таблице, коммутатор пересылает кадр через указанный порт. Если MAC-адреса назначения нет в таблице, коммутатор пересылает кадр через все порты, кроме входящего порта. Это называется одноадресной рассылкой неизвестному получателю.

Как показано на рисунке, в таблице коммутатора нет MAC-адреса назначения для компьютера PC-D, поэтому он пересылает кадр через все порты, кроме порта 1.

**Примечание**: Если MAC-адрес назначения является адресом широковещательной или многоадресной рассылки, коммутатор также пересылает кадр через все порты, кроме входящего.

![](./assets/7.3.2-2.png)


1.  Кадр имеет MAC-адрес назначения 00-0D и MAC-источник 00-0A. Единственная запись в таблице MAC-адресов сопоставляет порт 1 с MAC-адресом 00-0A.
2.  Кадр пересылается через порты 2, 3 и 4.

<!-- 7.3.3 -->
## Фильтрация кадров

Поскольку коммутатор получает кадры от разных устройств, его таблица MAC-адресов заполняется через проверку MAC-адреса источника каждого кадра. Если в таблице MAC-адресов коммутатора есть MAC-адрес назначения, он может выполнять фильтрацию кадров и пересылать его через один порт.

### От PC-D до коммутатора

На рисунке PC-D отвечает на PC-A. Коммутатор видит MAC-адрес PC-D во входящем кадре на порту 4. Затем коммутатор помещает MAC-адрес PC-D в таблицу MAC-адресов, связанную с портом 4.

![](./assets/7.3.3-1.png)


Коммутатор добавляет номер порта и MAC-адрес PC-D в свою таблицу MAC-адресов.

### От коммутатор до PC-A

Далее, поскольку коммутатор имеет MAC-адрес назначения для PC-A в таблице MAC-адресов, он отправит кадр только через порт 1, как показано на рисунке.

![](./assets/7.3.3-2.png)


Таблица MAC-адресов коммутатора содержит две записи. Порт 1 связан с MAC-адресом 00-0A, а порт 4 связан  с MAC-адресом 00-0D. Хост D отправляет кадр с MAC-адресом назначения 00-0A и исходным MAC-адресом 00-0D. Кадр отправляется из порта 1 на узел A, MAC-адрес которого 00-0A.

### От PC-A до коммутатора, от коммутатора до PC-D

Затем PC-A отправляет другой кадр PC-D, как показано на рисунке. Таблица MAC-адресов уже содержит MAC-адрес для PC-A; следовательно, пятиминутный таймер обновления для этой записи сбрасывается. Поскольку в таблице коммутатора уже есть MAC-адрес компьютера PC-D, он пересылает кадр только через порт 4.

![](./assets/7.3.3-3.png)


1.  Коммутатор получает другой кадр от PC-A и обновляет таймер для записи MAC-адреса для порта 1.
2.  Коммутатор имеет недавнюю запись для MAC-адреса назначения и фильтрует кадр, переадресовывая его только из порта 4.

<!-- 7.3.4 -->
## Видео: таблицы MAC-адресов на подключенных друг к другу коммутаторах

В таблице коммутатора может быть несколько MAC-адресов, связанных с одним портом. Обычно это происходит тогда, когда коммутатор соединен с другим коммутатором. В таблице MAC-адресов коммутатора вводится отдельная запись для каждого кадра, получаемого с другого MAC-адреса источника.

Просмотрите видео о построении таблиц МАС-адресов в двух соединенных между собой коммутаторах.

![youtube](https://www.youtube.com/watch?v=fi7Ss-_9LvY)

<!-- 7.3.5 -->
## Видео: отправка кадра на шлюз по умолчанию

Если IP-адрес устройства находится в удаленной сети, отправить кадр Ethernet в устройство назначения напрямую невозможно. Вместо этого кадр Ethernet отправляется по MAC-адресу шлюза по умолчанию, т. е. маршрутизатора.

Просмотрите видео об обмене данными между компьютером PC-A и шлюзом по умолчанию.

**Примечание**: В этом видео в IP-пакете, отправляемом с компьютера PC-A на устройство в удаленной сети, указаны IP-адрес источника компьютера PC-A и IP-адрес назначения удаленного узла. В возвращаемом IP-пакете указаны IP-адрес источника удаленного узла и IP-адрес назначения, т. е. адрес компьютера PC-A.

![youtube](https://www.youtube.com/watch?v=RXLercop7eU)

<!-- 7.3.6 -->
<!--## Упражнение. Коммутация в действии! -->

<!-- 7.3.7 -->
<!-- ## Лабораторная работа: просмотр таблицы MAC-адресов коммутатора

В этой лабораторной работе вы выполните следующие задачи.

* Часть 1: Создание и настройка сети
* Часть 2: Изучение таблицы МАС-адресов коммутатора

[Просмотр таблицы MAC-адресов коммутатора (лабораторная работа для физического оборудования)](./assets/7.3.7-lab---view-the-switch-mac-address-table_ru-RU.pdf)
 -->
