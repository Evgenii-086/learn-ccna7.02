#  Протокол ICMP: Резюме

<!-- 13.3.3 -->
##  Что я изучил в этом модуле?

**IСообщения ICMP**

Пакет TCP/IP обеспечивает сообщения об ошибках и информационные сообщения при взаимодействии с другим IP-устройством. Эти сообщения отправляются с помощью ICMP-сервисов. Назначение таких сообщений — предоставлять обратную связь о проблемах, связанных с обработкой IP-пакетов в определенных условиях, а не повышать надежность протокола IP. ICMP сообщения, общие для ICMPv4 и ICMPv6, являются: доступность узла, назначение или служба недостижима, а также превышение времени. 

Эхо-сообщение ICMP можно использовать для проверки доступности узла в IP-сети. Локальный узел отправляет узлу эхо-запрос ICMP. Если узел доступен, узел назначения отправляет эхо-ответ. Это основа работы инструмента **ping**. Когда узел или шлюз получает пакет, который не может доставить, он может использовать ICMP-сообщение «Узел назначения недоступен» (Destination Unreachable), чтобы сообщить источнику о том, что узел назначения или сервис для этого пакета недоступен. Такое сообщение содержит код, определяющий причину, по которой пакет не может быть доставлен. Сообщения ICMPv4 о превышении интервала ожидания (Time Exceeded) используется маршрутизатором для указания на то, что пакет невозможно переслать, поскольку значение в поле «Время существования» (Time to Live, TTL) пакета было изменено на 0. 

Если маршрутизатор получает пакет и изменяет значение в поле TTL IPv4-пакета на нуль, он отбрасывает пакет и отправляет на исходный узел сообщение о превышении интервала ожидания. ICMPv6 также отправляет время, превышенное в этой ситуации. В протоколе IPv6 поле TTL отсутствует; чтобы выяснить, не истек ли срок действия пакета, используется поле «предел переходов» (hop limit).  Инструмент **traceroute** использует сообщения о превышении времени. Сообщения между маршрутизатором IPv6 и устройством IPv6, включая динамическое распределение адресов, включают RS и RA. Сообщения между устройствами IPv6 включают перенаправление (аналогично IPv4), NS и NA.

**Тестирование при помощи ping и traceroute**

Ping (используется IPv4 и IPv6) использует эхо-запрос ICMP и эхо-сообщения для проверки соединения между хостами. Для проверки соединения с другим узлом в сети с помощью команды ping на узловой адрес отправляется эхо-запрос. Если узел с указанным адресом получает эхо-запрос, он отправляет эхо-ответ. После получения каждого эхо-ответа служба эхо-тестирования предоставляет данные о времени, прошедшем между отправкой ping-запроса и получением ответа. После отправки всех запросов утилита ping выдает отчет, содержащий уровень успешности запросов и среднее суммарное время доставки запросов и получения ответов. Ping может использоваться для проверки внутренней конфигурации IPv4 или IPv6 на локальном хосте. Для выполнения этой проверки отправим эхо-запрос на адрес loopback 127.0.0.1 для IPv4 (::1 для IPv6). 

Используйте **ping** для проверки способности хоста взаимодействовать в локальной сети путем pinging IP-адрес шлюза по умолчанию хоста. Успешная отправка эхо-запроса на шлюз позволяет убедиться, что хост и интерфейс маршрутизатора, выступающий в роли шлюза, нормально функционируют в данной локальной сети. Команду ping также можно использовать для проверки способности хоста обмениваться данными с другими сетями. С локального узла можно отправить **ping** на рабочий IPv4-узел удаленной сети. Команда traceroute (tracert) — это утилита, позволяющая составить список переходов, по которым успешно проходит эхо-запрос на пути к узлу назначения. Этот список предоставляет важные данные для проверки и устранения неисправностей. 

Если запрос доходит до узла назначения, утилита trace заносит в список интерфейс каждого маршрутизатора на пути между узлами. Если на каком-то переходе на маршруте происходит сбой передачи данных, то адрес последнего маршрутизатора, ответившего на трассировку, может указать на место нахождения проблемы или ограничения системы безопасности. RTT — это время, которое требуется на доставку пакета на удаленный узел и получения ответа от этого узла. Утилита traceroute использует значение в поле TTL в IPv4 и в поле предела переходов (Hop Limit) в IPv6 в заголовках 3-го уровня (вместе с сообщением ICMP о превышении интервала ожидания).

<!-- 13.3.4 -->
<!-- quiz -->

