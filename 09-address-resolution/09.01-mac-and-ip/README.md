<!-- verified: agorbachev 03.05.2022 -->

<!-- 9.1.1 -->
## Устройство назначения в той же сети

Иногда хост должен отправить сообщение, но он знает только IP-адрес устройства назначения. Хост также должен знать MAC-адрес этого устройства, но как его можно обнаружить? Именно здесь важнеейшее значение приобретает процесс разрешения адресов.

Устройству в локальной сети Ethernet присваиваются два основных адреса:

* **физический адрес (MAC-адрес)** — используется для обмена данными между сетевыми платами Ethernet устройств, находящихся в одной сети;
* **логический адрес (IP-адрес)** — используется для отправки пакетов от источника к назначению. IP-адрес назначения может находиться в той же сети, что и источник, либо в удаленной сети.

Они используются для доставки кадра, передаваемого по каналу в инкапсулированном IP-пакете, от одной сетевой интерфейсной платы к другой в той же сети. Если IP-адрес назначения находится в той же сети, то MAC-адресом назначения является адрес устройства назначения.

Рассмотрим следующий пример с использованием упрощенных MAC-адресов.

![](./assets/9.1.1.svg)


В этом примере ПК1 хочет отправить пакет к ПК2. На рисунке показаны MAC-адреса назначения и источника второго уровня, а также IPv4-адреса третьего уровня, которые будут включены в пакет, отправленный с ПК1.

Кадр Ethernet второго уровня содержит следующее:

* **MAC-адрес** (упрощенный MAC-адрес ПК2, 55-55);
* **исходный MAC-адрес** (упрощенный MAC-адрес сетевого адаптера Ethernet на ПК1, aa-aa-aa).

IP-пакет третьего уровня содержит следующее:

* **исходный IPv4-адрес** (IPv4-адрес ПК1, 192.168.10.10);
* **адрес назначения IPv4** (IPv4-адрес ПК2, 192.168.10.11).

<!-- 9.1.2 -->
## Устройство назначения в удаленной сети

Если IP-адрес назначения находится в удаленной сети, то MAC-адресом назначения является адрес шлюза хоста по умолчанию.

Рассмотрим следующий пример с использованием упрощенных MAC-адресов.

![](./assets/9.1.2-1.svg)


В этом примере ПК1 хочет отправить пакет к ПК2. ПК2 расположен в удаленной сети. Поскольку адрес назначения IPv4 не находится в той же локальной сети, что и ПК1, MAC-адрес назначения — это адрес локального шлюза по умолчанию (роутер).

Роутеры проверяют IPv4-адрес назначения для определения наилучшего способа пересылки IPv4-пакета. При получении роутером кадра Ethernet происходит деинкапсуляция информации второго уровня. На основе IP-адреса назначения роутер определяет следующее транзитное устройство и инкапсулирует IP-пакет в новый кадр для передачи в исходящий интерфейс.

В нашем примере R1 теперь инкапсулирует пакет с новой информацией адреса второго уровня, как показано на рисунке.

![](./assets/9.1.2-2.svg)


Новый MAC-адрес назначения будет адрес интерфейса R2 G0/0/1, а новый MAC-адрес источника будет адрес интерфейса R1 G0/0/1.

В каждом канале на пути IP-пакет инкапсулируется в кадр. Кадр связан с конкретной технологии канала передачи данных, связанной с этим каналом, например, Ethernet. Если следующее транзитное устройство является назначением, MAC-адресом назначения будет адрес сетевой платы Ethernet этого устройства, как показано на рисунке.

![](./assets/9.1.2-3.svg)


Каким образом IP-адреса IP-пакетов в потоке данных ассоциируются с MAC-адресами в каждом канале на пути к узлу назначения? В IPv4 для этого используется протокол разрешения адресов (ARP). Для пакетов IPv6 этим процессом является обнаружение соседей ICMPv6 (ND).

<!-- 9.1.4 -->
<!-- quiz -->

