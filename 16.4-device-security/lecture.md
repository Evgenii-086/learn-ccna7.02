<!-- verified: agorbachev 03.05.2022 -->

<!-- 16.4.1 -->
## Cisco AutoSecure 

Одной из областей сетей, требующих особого внимания для поддержания безопасности, являются устройства. Вероятно, у вас уже есть пароль для компьютера, смартфона или планшета. Является ли он максимально безопасным? Используете ли вы другие инструменты для повышения безопасности своих устройств? В этом разделе рассказывается о том, как это сделать.

При установке на устройство новой операционной системы настройки системы безопасности имеют значения по умолчанию. В большинстве случаев этот уровень безопасности является недостаточным. В маршрутизаторах Cisco для обеспечения безопасности системы можно использовать функцию Cisco AutoSecure, как показано в примере.

```
Router# auto secure
                --- AutoSecure Configuration ---
*** AutoSecure configuration enhances the security of
the router but it will not make router absolutely secure
from all security attacks ***
```

Кроме того, существует ряд простых шагов, которые можно применить для большинства операционных систем.

* Установленные по умолчанию имена пользователей и пароли необходимо немедленно изменить.
* Доступом к системным ресурсам должны обладать только лица, наделенные соответствующими правами.
* Все невостребованные службы и приложения при возможности необходимо отключить или удалить.

Зачастую устройства, полученные от производителя, до отгрузки хранились на складе в течение определенного периода, и поэтому на них не установлены актуальные обновления. Прежде чем внедрять любое ПО, важно сначала его обновить и установить любые имеющиеся обновления для системы безопасности.

<!-- 16.4.2 -->
## Пароли

Для защиты сетевых устройств необходимо использовать надежные пароли. Ниже приведены стандартные рекомендации по выбору пароля.

* Используйте пароль длиной не менее 8 символов (предпочтительно 10 и более символов). Чем длиннее пароль, тем он надежнее.
* Выбирайте сложные пароли. Включайте в пароль комбинацию букв в верхнем и нижнем регистре, цифр, специальных символов и пробелов (если допускается их использование).
* Избегайте использования паролей, созданных на основе повторений, обычных слов из словаря, последовательностей букв или цифр, имени пользователя, имен родственников и домашних животных, биографических данных (дата рождения, номер паспорта, имена родителей и другие данные, которые легко выяснить).
* Допустите в пароле намеренную ошибку. Например, Ivanov = Ivonov = 1vOnov или Security = 5ecur1ty.
* Периодически меняйте пароли. Если пароль был случайно скомпрометирован, возможности использования его злоумышленниками будут ограничены.
* Не записывайте пароли на бумаге и не оставляйте их в легко доступных местах (например, на столе или на мониторе).

На рисунке показаны примеры надежных и ненадежных паролей.

### Ненадежные пароли

| Ненадежный пароль | Почему пароль ненадежный |
| --- | --- |
| secret | Простое словарное слово |
| smith | Девичья фамилия матери |
| toyota | Марка автомобиля |
| bob1967 | Имя и год рождения пользователя |
| Blueleaf23 | Простые слова и цифры |

### Надежные пароли

| Надежный пароль | Почему пароль надежный |
| --- | --- |
| b67n42d39c | Сочетание букв и цифр |
| 12^h u4@1p7 | Сочетание букв и цифр, специальных символов, а также пробела |

Маршрутизаторы Cisco игнорируют начальные пробелы в паролях, но пробелы после первого символа учитываются. Таким образом, один из способов создать надежный пароль — использовать пробел в пароле и задать фразу, состоящую из нескольких слов. Это называется парольной фразой. Парольную фразу зачастую проще запомнить, чем обычный пароль. Парольная фраза также имеет большую длину, чем простой пароль, и ее сложнее подобрать.

<!-- 16.4.3 -->
## Расширенная защита пароля

Самые надежные пароли полезны ровно до тех пор, пока они никому не известны. Существует ряд действий, которые можно выполнить, чтобы обеспечить сохранность пароля в тайне на маршрутизаторах и коммутаторах включающих следующее:

* Зашифруйте все открытые пароли.
* Установка минимальной допустимой длины пароля
* Предотвращение атак с использованием пароля грубой силы
* Отключение доступа к неактивному привилегированному режиму EXEC через определенное время.

Использование команды глобальной конфигурации **service password-encryption** предотвращает несанкционированный доступ для просмотра паролей в виде обычного текста в файле конфигурации, как показано на рисунке. Команда шифрует все открытые пароли. Обратите внимание на пример, что пароль «cisco» был зашифрован как «03095A0F034F».

Кроме того, чтобы все настроенные пароли имели длину не менее заданного значения, следует использовать команду **security passwords min-length** в режиме глобальной конфигурации. На рисунке любой новый настроенный пароль должен иметь минимальную длину восьми символов.

Злоумышленники могут использовать программное обеспечение для взлома паролей для атаки грубой силы на сетевое устройство. Эта атака постоянно пытается угадать действительные пароли до тех пор, пока они не сработают. Используйте команду **login block-for _#_ attempts _#_ within _#_** глобальной конфигурации для предотвращения такого типа атак. Команда **login block-for 120 attempts 3 within 60** будет блокировать попытки входа в систему в течение 120 секунд, если в течение 60 секунд произойдет три неудачных попытки входа.

Сетевые администраторы могут отвлекаться и случайно оставить привилегированный сеанс EXEC открытым на терминале. Это может позволить внутреннему злоумышленнику изменить или стереть конфигурацию устройства.

По умолчанию маршрутизаторы Cisco выйдут из сеанса EXEC после 10 минут бездействия. Однако, этот параметр можно уменьшить с помощью команды конфигурации **exec-timeout** _minutes seconds_ line. Эту команду можно применить  консольные, вспомогательные и vty линии. На рисунке мы говорим устройству Cisco автоматически отключать неактивного пользователя на линии vty после того, как пользователь простаивал в течение 5 минут 30 секунд.

```
R1(config)# service password-encryption 
R1(config)# security passwords min-length 8 
R1(config)# login block-for 120 attempts 3 within 60
R1(config)# line vty 0 4 
R1(config-line)# password cisco123 
R1(config-line)# exec-timeout 5 30 
R1(config-line)# transport input ssh 
R1(config-line)# end 
R1# 
R1# show running-config | section line vty
line vty 0 4
 password 7 094F471A1A0A
 exec-timeout 5 30
 login
 transport input ssh
R1#
```

<!-- 16.4.4 -->
## Активация подключения по SSH

Telnet упрощает удаленный доступ к устройствам, но не является безопасным. Данные в пакете Telnet передаются в незашифрованном виде. По этой причине в целях обеспечения безопасного удаленного доступа настоятельно рекомендуется использовать на устройствах протокол SSH.

Настройка поддержки протокола SSH для устройства Cisco выполняется в четыре этапа, как показано на рисунке.

**Шаг 1.** Устройство должно иметь уникальное имя хоста, отличное от имени по умолчанию.

**Шаг 2.** Настройте имя IP-домена сети с помощью команды режима глобальной конфигурации **ip-domain name**.

**Шаг 3.** SSH шифрует трафик между источником и получателем. Однако для этого уникальный ключ проверки подлинности должен быть создан с помощью команды глобальной конфигурации **crypto key generate rsa general-keys modulus** _bits_. Следует лишь отметить, что модуль определяет размер ключа, который может быть в диапазоне от 360 бит до 2048 бит. Чем больше значение бит, тем безопаснее ключ. Однако большие значения битов также требовать больше времени для шифрования и расшифровки информации. Минимальная рекомендуемая длина модуля — 1024 бит.

**Шаг 4.** Создайте учетную запись пользователя в локальной базе данных с помощью команды **username** в режиме глобальной конфигурации. В примере параметр **secret** используется так, чтобы пароль был зашифрован с помощью MD5.

**Шаг 5.** Используйте команду конфигурации **login local** строки для проверки подлинности строки vty в локальной базе данных.

**Шаг 6.** По умолчанию сеанс  не разрешен на линиях vty. С помощью **transport input \[ssh | telnet\]** команды можно указать несколько  протоколов, включая Telnet и SSH.

Как показано в примере, маршрутизатор R1 настроен в домене span.com. Эта информация используется вместе с битовым значением, указанным в **crypto key generate rsa general-keys modulus** команде, для создания ключа шифрования.

Затем создается запись локальной базы данных для пользователя с именем Bob. Наконец,  vty настроены на аутентификацию в локальной базе данных и могут принимать только входящие  SSH сессии. 

```
Router# configure terminal
Router(config)# hostname R1
R1(config)# ip domain name span.com
R1(config)# crypto key generate rsa general-keys modulus 1024
The name for the keys will be: Rl.span.com % The key modulus size is 1024 bits
% Generating 1024 bit RSA keys, keys will be non-exportable...[OK]
Dec 13 16:19:12.079: %SSH-5-ENABLED: SSH 1.99 has been enabled
R1(config)#
R1(config)# username Bob secret cisco
R1(config)# line vty 0 4
R1(config-line)# login local
R1(config-line)# transport input ssh
R1(config-line)# exit
R1(config)#
```

<!-- 16.4.5 -->
## Отключите неиспользуемые службы

Маршрутизаторы и коммутаторы Cisco запускаются  с большим списком активных служб, которые могут потребоваться или не потребоваться при работе в  сети. Отключите все неиспользуемые службы, чтобы сохранить системные ресурсы, такие как  ЦП и ОЗУ, и предотвратить использование этих служб злоумышленниками. Тип служб, которые по умолчанию включен, зависит от версии IOS. Например, IOS-XE обычно имеет открытые только порты HTTPS и DHCP. Это можно проверить с помощью  команды **show ip ports all**, как показано в примере.

```
Router# show ip ports all
Proto Local Address               Foreign Address             State       PID/Program Name
TCB       Local Address               Foreign Address             (state)
tcp   :::443                     :::*                        LISTEN      309/[IOS]HTTP CORE
tcp   *:443                      *:*                         LISTEN      309/[IOS]HTTP CORE
udp   *:67                        0.0.0.0:0                               387/[IOS]DHCPD Receive
Router#
```

В версиях IOS, предшествующих IOS-XE, используется  команда **show control-plane host open-ports**. Мы упоминаем эту команду, потому что вы можете увидеть ее на старых устройствах. Выходные данные аналогичны. Однако, обратите внимание, что этот старый маршрутизатор имеет небезопасный HTTP-сервер и работает Telnet. Обе эти службы должны быть отключены. Как показано в примере, отключите HTTP командой **no ip http server** в режиме глобальной конфигурации. Отключите Telnet, указав только SSH в команде конфигурации строки **transport input ssh**.

```
Router# show control-plane host open-ports 
Active internet connections (servers and established)
Prot        Local Address      Foreign Address                  Service    State
 tcp                 *:23                  *:0                   Telnet   LISTEN
 tcp                 *:80                  *:0                HTTP CORE   LISTEN
 udp                 *:67                  *:0            DHCPD Receive   LISTEN
Router# configure terminal
Router(config)# no ip http server
Router(config)# line vty 0 15
Router(config-line)# transport input ssh
```

<!-- 16.4.6 -->
## Работа в симуляторе: настройка безопасного пароля и протокола SSH

Администратор сети обратился к вам с просьбой подготовить RTA и SW1 для развертывания. Перед его подключением к сети необходимо активировать функции безопасности.

[Настройка безопасного пароля и протокола SSH (pdf)](./assets/16.4.6-packet-tracer---configure-secure-passwords-and-ssh.pdf)

[Настройка безопасного пароля и протокола SSH (pka)](./assets/16.4.6-packet-tracer---configure-secure-passwords-and-ssh.pka)

<!-- 16.4.7 -->
<!-- ## Лабораторная работа: доступ к сетевым устройствам по протоколу SSH

В этой лабораторной работе вы выполните следующие задачи:

* Часть 1: Настройка основных параметров устройств
* Часть 2: Настройка маршрутизатора для доступа по протоколу SSH
* Часть 3: Настройка коммутатора для доступа по протоколу SSH
* Часть 4: Настройка протокола SSH с использованием интерфейса командной строки (CLI) коммутатора

[Доступ к сетевым устройствам по протоколу SSH (лабораторная работа для физического оборудования)](./assets/16.4.7-lab---configure-network-devices-with-ssh.pdf) -->

