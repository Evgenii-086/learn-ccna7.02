<!-- verified: agorbachev 03.05.2022 -->

<!-- 14.4.1 -->
## Несколько отдельных сеансов передачи данных

Как вы узнали, в некоторых ситуациях TCP является подходящим протоколом для работы, а в других - UDP. Независимо от того, какой тип данных передается, как TCP, так и UDP используют номера портов.

Протоколы транспортного уровня TCP и UDP используют номера портов для управления несколькими одновременными сеансами связи. Как показано на рисунке, поля заголовка TCP и UDP определяют номер порта приложения источника и назначения.

![](./assets/14.4.1.png)


Номер порта источника связан с исходным приложением на локальном узле, тогда как номер порта назначения связан с целевым приложением на удаленном узле.

Например, предположим, что хост инициирует запрос веб-страницы с веб-сервера. Когда узел инициирует запрос веб-страницы, номер порта источника динамически генерируется хостом для уникальной идентификации диалога. Каждый запрос, сгенерированный хостом, будет использовать другой динамически созданный номер порта источника. Благодаря этому можно устанавливать несколько сеансов связи одновременно.

В запросе, номер порта назначения определяет тип запрашиваемой услуги веб-сервера назначения. Например, если клиент в описании для порта назначения указывает порт 80, то сервер, принимающий это сообщение, уже знает, что запрашиваются веб-сервисы.

Сервер может одновременно предоставлять веб-сервисы через порт 80 и организовать подключение по протоколу FTP через порт 21 для обмена файлами.

<!-- 14.4.2 -->
## Пары сокетов

Номера порта источника и порта назначения записываются в сегмент. Затем эти сегменты инкапсулируются в пакете IP. В пакете IP записывается IP-адрес источника и назначения. Сочетание IP-адреса источника и номера порта источника или IP-адреса назначения и номера порта назначения называется сокетом.

В примере на рисунке компьютер одновременно запрашивает FTP-и веб-службы с сервера назначения.

![](./assets/14.4.2.png)


В примере FTP-запрос, созданный ПК, включает MAC-адреса и IP-адреса. Запрос также идентифицирует исходный порт номер 1305 (т.е. динамически генерируется хостом) и порт назначения, идентифицируя службы FTP на порту 21. Хост также запросил веб-страницу с сервера, используя те же адреса уровня 2 и уровня 3. Тем не менее, он использует исходный порт номер 1099 (т.е. динамически генерируется хостом) и порт назначения, идентифицирующий веб-службу на порту 80.

Сокет используется для определения сервера и служб, запрашиваемых клиентом. Сокет клиента может иметь следующий вид, где 1099 — это номер порта источника: 192.168.1.5:1099.

Сокет веб-сервера может иметь следующий вид: 192.168.1.7:80.

Вместе эти два сокета образуют следующую пару: 192.168.1.5:1099, 192.168.1.7:80.

Сокеты позволяют различать несколько процессов, выполняющихся на клиенте, а также распознавать различные подключения к процессу сервера.

Номер порта источника играет роль обратного адреса для запрашивающего приложения. Протоколы транспортного уровня отслеживают порт и приложение-источник запроса, чтобы соответствующему приложению можно было отправить отклик.

<!-- 14.4.3 -->
## Группы номеров портов

Разработка различных стандартов адресации, включая нумерацию портов, выполняется Администрацией адресного пространства Интернет (Internet Assigned Numbers Authority, IANA). 16 битов, используемых для идентификации номеров портов источника и назначения, обеспечивают диапазон портов от 0 до 65535.

IANA разделила диапазоны номеров на следующие три группы.

| **Группа портов** | **Диапазон номеров портов** | **Описание** |
| --- | --- | --- |
| **Общеизвестные порты** | **От 0 до 1023** | <ul><li>Эти номера портов зарезервированы для обычных или популярных служб и приложениями, такими как веб-браузеры и почтовые клиенты, а также клиентами удаленного доступа.</li><li>Определенные известные порты для общих серверных приложений позволяют легко определить требуемый сервис.</li></ul> |
| **Зарегистрированные порты** | **От 1024 до 49151** | <ul><li>Эти номера портов присваиваются IANA запрашивающему объекту для использования с конкретными процессами или приложениями.</li><li>Эти процессы в основном представляют собой отдельные приложения, которые пользователь выбрал для установки, а не обычные приложения, которые получили бы известный номер порта.</li><li>Например, Cisco зарегистрировала порт 1812 для своего процесса аутентификации RADIUS-сервера.</li></ul> |
| **Частные**  и/или  **динамические порты** | **От 49152 до 65535** | <ul><li>Эти порты также известны как *временные порты*.</li><li>ОС клиента обычно присваивает номера портов динамически, когда инициируется подключение к сервису.</li><li>После чего такой порт используется для определения клиентского приложения во время обмена данными.</li></ul> |

**Примечание**: В некоторых клиентских ОС для назначения портов источника вместо динамических портов могут использоваться зарегистрированные порты. 

В таблице показаны некоторые стандартные порты и связанные с ними приложения.

| **Номер порта** | **Протокол** | **Уровень приложений** |
| --- | --- | --- |
| **20** | TCP | File Transfer Protocol (FTP) - Передача данных  |
| **21** | TCP | File Transfer Protocol (FTP) - Управление передачей |
| **22** | TCP | Протокол Secure Shell (SSH) |
| **23** | TCP | Программа Telnet |
| **25** | TCP | Протокол SMTP |
| **53** | UDP, TCP | Служба доменных имен (DNS) |
| **67** | UDP | Сервер протокола динамической конфигурации узла (Dynamic Host Configuration Protocol, DHCP) |
| **68** | UDP | Dynamic Host Configuration Protocol (Протокол динамической настройки узла) (клиент) |
| **69** | UDP | Простейший протокол передачи файлов (TFTP) |
| **80** | TCP | Протокол HTTP |
| **110** | TCP | Протокол почтового отделения (Post Office Protocol version 3, POP3) |
| **143** | TCP | Протокол IMAP |
| **161** | UDP | Протокол SNMP |
| **443** | TCP | Защищенный протокол передачи гипертекста (HTTPS) |

Некоторые приложения могут использовать как протокол TCP, так и UDP. Например, для отправки запросов клиентов на DNS-сервер используется протокол UDP. Однако взаимодействие двух DNS-серверов друг с другом всегда осуществляется по протоколу TCP.

Чтобы ознакомиться с полным списком номеров портов и соответствующих приложений перейдите на веб-сайт IANA.

<!-- 14.4.4 -->
## Команда netstat

Неопознанные TCP-соединения могут представлять значительную угрозу безопасности. Они могут указывать на наличие посторонних подключений к локальному узлу. В некоторых случаях требуется определить, какие TCP-соединения открыты и действуют на сетевом узле. Проверить состояние этих соединений помогает важное программное средство – netstat. Команда **netstat** позволяет получить список используемых протоколов, локальных адресов и номеров портов, адрес и номер порта на удаленном узле, а также сообщает состояние соединений.

```
C:\> netstat

Active Connections

  Proto  Local Address          Foreign Address            State
  TCP    192.168.1.124:3126     192.168.0.2:netbios-ssn    ESTABLISHED
  TCP    192.168.1.124:3158     207.138.126.152:http       ESTABLISHED
  TCP    192.168.1.124:3159     207.138.126.169:http       ESTABLISHED
  TCP    192.168.1.124:3160     207.138.126.169:http       ESTABLISHED
  TCP    192.168.1.124:3161     sc.msn.com:http            ESTABLISHED
  TCP    192.168.1.124:3166     www.cisco.com:http         ESTABLISHED
(output omitted)
C:\>
```

По умолчанию команда **netstat** пытается разрешить IP-адреса в имена доменов, а номера портов — в названия общеизвестных приложений. Чтобы отобразить IP-адреса и номера портов в числовой форме, можно использовать параметр **\-n**.

<!-- 14.4.5 -->
<!-- quiz -->

